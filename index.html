<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ðŸŒŒ Space Factory</title>
<style>
:root {
    --bg: #071028;
    --panel: #0f1b3a;
    --accent: #6fb3ff;
    --muted: #9fb5d9;
    --glass: rgba(255,255,255,0.04);
}
html, body {
    margin: 0;
    height: 100%;
    background: linear-gradient(180deg,var(--bg),#031026);
    color: #eaf4ff;
    font-family: Inter, monospace;
}
.galaxy-header {
    padding: 28px 0 10px 0;
    text-align: center;
}
.galaxy-title {
    font-size: clamp(28px,4vw,48px);
    font-weight: 800;
    background: linear-gradient(90deg, #6fb3ff, #9f70ff, #ff70d7, #6fb3ff);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: galaxyFlow 8s ease infinite;
    text-shadow: 0 0 18px rgba(125,150,255,0.35),0 0 35px rgba(150,90,255,0.25);
    margin:0;
}
.galaxy-subtitle {
    margin-top: 6px;
    font-size: 15px;
    color: #bcd7ff;
}
@keyframes galaxyFlow {
    0% { background-position:0% 50%; }
    50% { background-position:100% 50%; }
    100% { background-position:0% 50%; }
}
#wrap {
    display:flex; gap:16px; padding:16px; justify-content:center; flex-wrap:wrap;
}
.panel{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.04);
    border-radius:12px;
    padding:12px;
    width:340px;
    box-shadow:0 6px 20px rgba(3,6,20,0.6);
}
.wide{ width:720px; }
.resource{ display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px dashed rgba(255,255,255,0.03); }
.muted{ color:var(--muted); font-size:13px; }
.stat{ font-weight:700; }
button{
    background: linear-gradient(180deg,var(--accent),#4e8fe3);
    border:none;
    color:#02112a;
    padding:8px 10px;
    border-radius:8px;
    cursor:pointer;
    font-weight:700;
}
button:hover{ filter: brightness(1.1); }
button:disabled{ opacity:0.45; cursor:not-allowed; }
.bigbtn{ padding:12px 14px; font-size:15px; }
</style>
</head>
<body>

<header class="galaxy-header">
<h1 class="galaxy-title">ðŸŒŒ Space Factory</h1>
<div class="galaxy-subtitle">Build, upgrade, and explore the stars!</div>
</header>

<div id="planetSelector" class="panel" style="margin:auto;margin-top:20px;width:380px;">
<h3>Select Starting Planet</h3>
<button onclick="startPlanet('Lunar')">ðŸŒ• Lunar â€” ore rich</button><br><br>
<button onclick="startPlanet('Mars')">ðŸ”´ Mars â€” balanced</button><br><br>
<button onclick="startPlanet('Europa')">ðŸ§Š Europa â€” energy rich</button>
<div class="muted" style="margin-top:10px;">More planets unlock later.</div>
</div>

<div id="mainHUD" style="display:none;">
<div class="muted">Planet: <span id="planetName">â€”</span></div>
<div class="muted">Space: <span id="spaceState">Locked</span></div>
<div class="save-indicator" id="saveStatus">Not saved</div>
</div>

<div id="wrap" style="display:none;">
    <div class="panel">
        <h3>Manual Actions</h3>
        <button class="bigbtn" onclick="manualMine()">Activate Astro Drill</button>
        <button class="bigbtn" onclick="manualEnergy()">Deploy Solar Collector</button>
        <hr>
        <h3>Storage</h3>
        <button class="bigbtn" id="storageBtn" onclick="upgradeStorage()">Expand Storage Bays</button>
    </div>

    <div class="panel wide">
        <h3>Resources</h3>
        <div id="resourcesList"></div>
        <hr>
        <h3>Factories</h3>
        <div id="buildGrid"></div>
        <div id="advancedGrid"></div>
    </div>

    <div class="panel">
        <h3>Structures</h3>
        <div class="muted">Shipyard: <span id="shipyardCount">0</span></div>
        <div class="muted">AI Lab: <span id="aiLabCount">0</span></div>
        <div class="muted">Spaceport: <span id="spaceportCount">0</span></div>
        <br>
        <button onclick="buildStructure('Spaceport')" id="unlockSpaceBtn">
            Unlock Space (500 ore / 200 metal / 150 energy)
        </button>
        <div class="muted" id="unlockText">Space locked â€” gather resources.</div>
        <br><br>
        <button class="bigbtn" style="background:#ff4d4d;" onclick="openResetMenu()">Reset Game</button>
    </div>
</div>

<div id="resetPopup" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#222;padding:20px;border-radius:8px;box-shadow:0 0 10px #ff4d4d;color:white;z-index:1000;text-align:center;min-width:250px;">
<p style="font-size:1.2em;margin-bottom:15px;">Are you sure you want to reset?</p>
<button onclick="resetGame()" style="margin-right:10px;background:#ff4d4d;color:white;">Yes</button>
<button onclick="closeResetMenu()">No</button>
</div>

<div id="resetOverlay" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:999;"></div>

<script>
// =====================
// Game State
// =====================
const initialState = {
    planet:null,
    spaceUnlocked:false,
    resources:{ ore:0, metal:0, energy:0, crystal:0, alloy:0, circuit:0 },
    storageCap:{ ore:1000, metal:500, energy:500, crystal:200, alloy:200, circuit:100 },
    storageLevel:0,
    factories:{ astroMiner:0, solarHarvester:0, metalRefiner:0, alloySynthesizer:0, crystalForge:0, techFabricator:0 },
    structures:{ shipyard:0, aiLab:0, spaceport:0 },
    planetsOwned: [],
    lastSaved:null,
    tickAccumulator:0
};
let state = load()||JSON.parse(JSON.stringify(initialState));

// =====================
// Factories
// =====================
const factoriesDef = {
    astroMiner:{ display:"Astro Miner", cost:{ore:20,energy:5}, produce:{ore:1} },
    solarHarvester:{ display:"Solar Harvester", cost:{ore:10}, produce:{energy:1} },
    metalRefiner:{ display:"Metal Refiner", cost:{ore:50,energy:10}, consume:{ore:3}, produce:{metal:1} },
    alloySynthesizer:{ display:"Alloy Synthesizer", cost:{metal:20,energy:10}, consume:{metal:2,energy:2}, produce:{alloy:1} },
    crystalForge:{ display:"Crystal Forge", cost:{metal:50,energy:20}, consume:{metal:5,energy:5}, produce:{crystal:1} },
    techFabricator:{ display:"Tech Fabricator", cost:{crystal:10,alloy:5,energy:30}, consume:{crystal:2,alloy:3,energy:10}, produce:{circuit:1} }
};

// =====================
// Helpers
// =====================
function canAfford(cost){
    for(const r in cost) if((state.resources[r]||0)<cost[r]) return false;
    return true;
}
function payCost(cost){ for(const r in cost) state.resources[r]-=cost[r]; }
function addResource(r,a){ state.resources[r]=(state.resources[r]||0)+a; if(state.resources[r]>state.storageCap[r]) state.resources[r]=state.storageCap[r]; }
function save(){ state.lastSaved=Date.now(); localStorage.setItem("spaceFactorySave",JSON.stringify(state)); }
function load(){ try{ const raw=localStorage.getItem("spaceFactorySave"); return raw?JSON.parse(raw):null;}catch{return null;} }

// =====================
// UI Rendering
// =====================
function renderResources(){
    const el=document.getElementById("resourcesList"); el.innerHTML="";
    for(const r in state.resources){
        if(state.resources[r]>0||r==="ore"||r==="energy"){ // show only obtainable
            const val=state.resources[r]; const cap=state.storageCap[r];
            const div=document.createElement("div");
            div.className="resource";
            div.innerHTML=`<div class="muted">${r}</div><div><span class="stat">${val}</span> / ${cap}</div>`;
            el.appendChild(div);
        }
    }
}

function renderFactories(){
    const grid=document.getElementById("buildGrid"); grid.innerHTML="";
    for(const key in factoriesDef){
        const fac=factoriesDef[key];
        if(canAfford(fac.cost)){
            const btn=document.createElement("button");
            btn.textContent=`Build ${fac.display} (${Object.entries(fac.cost).map(([k,v])=>v+" "+k).join(" / ")})`;
            btn.onclick=()=>{ buildFactory(key); };
            grid.appendChild(btn);
        }
    }
}

function renderStorageBtn(){
    const costOre=200*(state.storageLevel+1);
    const costMetal=100*(state.storageLevel+1);
    const costEnergy=50*(state.storageLevel+1);
    const btn=document.getElementById("storageBtn");
    if(canAfford({ore:costOre,metal:costMetal,energy:costEnergy})){
        btn.style.display="block"; btn.textContent=`Expand Storage Bays (${costOre} Ore / ${costMetal} Metal / ${costEnergy} Energy)`;
    }else btn.style.display="none";
}

function renderAll(){
    renderResources(); renderFactories(); renderStorageBtn();
    document.getElementById("planetName").innerText=state.planet||"â€”";
    document.getElementById("spaceState").innerText=state.spaceUnlocked?"Unlocked":"Locked";
}

// =====================
// Actions
// =====================
function startPlanet(name){
    state=JSON.parse(JSON.stringify(initialState));
    state.planet=name; state.planetsOwned=[name]; state.resources.ore=50; state.resources.metal=20; state.resources.energy=10;
    document.getElementById("planetSelector").style.display="none";
    document.getElementById("mainHUD").style.display="block";
    document.getElementById("wrap").style.display="flex";
    renderAll(); save();
}
function manualMine(){ addResource("ore",1); renderAll(); save(); }
function manualEnergy(){ addResource("energy",1); renderAll(); save(); }
function buildFactory(key){
    const fac=factoriesDef[key];
    if(canAfford(fac.cost)){
        payCost(fac.cost);
        if(fac.consume) for(const r in fac.consume) state.resources[r]-=fac.consume[r];
        for(const r in fac.produce) addResource(r,fac.produce[r]);
        state.factories[key]++;
        renderAll(); save();
    }
}
function upgradeStorage(){
    const cost={ ore:200*(state.storageLevel+1), metal:100*(state.storageLevel+1), energy:50*(state.storageLevel+1) };
    if(canAfford(cost)){ payCost(cost); state.storageLevel++; for(const r in state.storageCap) state.storageCap[r]=Math.floor(state.storageCap[r]*1.5); renderAll(); save(); }
}
function buildStructure(name){
    if(name==="Spaceport"){ const cost={ore:500,metal:200,energy:150}; if(!canAfford(cost)) return; payCost(cost); state.structures.spaceport++; state.spaceUnlocked=true; renderAll(); save(); }
}

// =====================
// Reset Menu
// =====================
function openResetMenu(){ document.getElementById("resetPopup").style.display="block"; document.getElementById("resetOverlay").style.display="block"; }
function closeResetMenu(){ document.getElementById("resetPopup").style.display="none"; document.getElementById("resetOverlay").style.display="none"; }
function resetGame(){ closeResetMenu(); state=JSON.parse(JSON.stringify(initialState)); save(); location.reload(); }

// =====================
// Auto Production
// =====================
function autoProduce(dt){
    for(const key in factoriesDef){
        const fac=factoriesDef[key];
        const count=state.factories[key];
        for(let i=0;i<count;i++){
            if(fac.consume){ let can=true; for(const r in fac.consume) if(state.resources[r]<fac.consume[r]*dt) can=false; if(!can) continue; for(const r in fac.consume) state.resources[r]-=fac.consume[r]*dt; }
            for(const r in fac.produce) addResource(r,fac.produce[r]*dt);
        }
    }
}

// =====================
// Game Loop
// =====================
let lastTime=Date.now();
function gameLoop(){
    const now=Date.now();
    let dt=(now-lastTime)/1000; lastTime=now;
    if(dt>0.25) dt=0.25;
    autoProduce(dt);
    state.tickAccumulator+=dt;
    if(state.tickAccumulator>0.4){ renderAll(); state.tickAccumulator=0; }
    if(!state.lastSaved||Date.now()-state.lastSaved>10000) save();
    requestAnimationFrame(gameLoop);
}

// =====================
// Init
// =====================
renderAll();
requestAnimationFrame(gameLoop);
</script>
</body>
</html>

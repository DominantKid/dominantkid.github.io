<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŒŒ Space Factory - Full Version</title>
<style>
body { font-family: monospace; background: #071028; color: #eaf4ff; margin:0; padding:0; }
header { text-align:center; padding:20px 0; }
.galaxy-title { font-size:40px; background:linear-gradient(90deg,#6fb3ff,#9f70ff,#ff70d7,#6fb3ff); -webkit-background-clip:text; -webkit-text-fill-color:transparent; animation:flow 8s linear infinite; }
@keyframes flow { 0%{background-position:0%} 50%{background-position:100%} 100%{background-position:0%} }
.panel { background:#0f1b3a; padding:15px; border-radius:10px; margin:10px auto; max-width:600px; }
button { padding:8px 12px; margin:5px; border:none; border-radius:5px; background:#6fb3ff; color:#02112a; cursor:pointer; }
button:disabled { opacity:0.5; cursor:not-allowed; }
#resetPopup, #resetOverlay { position:fixed; top:0; left:0; width:100%; height:100%; display:none; justify-content:center; align-items:center; }
#resetOverlay { background: rgba(0,0,0,0.5); z-index:900; }
#resetPopup { background:#222; padding:20px; border-radius:10px; z-index:1000; text-align:center; }
</style>
</head>
<body>

<header>
<h1 class="galaxy-title">ðŸŒŒ Space Factory</h1>
<div class="galaxy-subtitle">Mine, build, research, and dominate the galaxy!</div>
</header>

<div id="planetSelector" class="panel">
    <h3>Select Starting Planet</h3>
    <button onclick="startPlanet('Lunar')">ðŸŒ• Lunar</button>
    <button onclick="startPlanet('Mars')">ðŸ”´ Mars</button>
    <button onclick="startPlanet('Europa')">ðŸ§Š Europa</button>
</div>

<div id="mainHUD" style="display:none;">
    <div class="panel">
        <h3>Resources</h3>
        <div id="resourcesList"></div>

        <h3>Storage Upgrade</h3>
        <div id="storageUpgradeArea"></div>

        <h3>Manual Actions</h3>
        <button onclick="manualMine()">Mine Ore</button>
        <button onclick="manualEnergy()">Generate Energy</button>

        <h3>Factories</h3>
        <div id="buildGrid"></div>

        <h3>Advanced Factories</h3>
        <div id="advancedGrid"></div>

        <h3>Research & Tech</h3>
        <div id="researchGrid"></div>

        <h3>Achievements</h3>
        <div id="achievementsList"></div>

        <button onclick="openResetMenu()" style="background:#ff4d4d;">Reset Game</button>
    </div>
</div>

<div id="resetOverlay"></div>
<div id="resetPopup">
    <p>Are you sure you want to reset?</p>
    <button onclick="resetGame()" style="background:#ff4d4d;">Yes</button>
    <button onclick="closeResetMenu()">No</button>
</div>

<script>
/* ===============================
        GAME STATE
================================*/
const initialState = {
    planet: null,
    resources: { ore:0, metal:0, energy:0, alloy:0, crystal:0, circuit:0, advancedTech:0 },
    storageCap: { ore:1000, metal:500, energy:500, alloy:100, crystal:50, circuit:20, advancedTech:5 },
    factories: { oreFactory:0, energyGen:0, smelter:0, alloySmelter:0, crystalLab:0, circuitFab:0 },
    upgrades: { storageLevel:0 },
    research: { oreBoost:0, metalBoost:0, energyBoost:0 },
    achievements: {},
    lastSaved: null
};
let state = load() || JSON.parse(JSON.stringify(initialState));

const planets = {
    Lunar: { bonus:{ore:50} },
    Mars: { bonus:{metal:50} },
    Europa: { bonus:{energy:50} }
};

/* ===============================
        COSTS AND PRODUCTION
================================*/
const buildCosts = {
    oreFactory:{ ore:20, energy:5 },
    energyGen:{ ore:10 },
    smelter:{ ore:50, energy:10 },
    alloySmelter:{ metal:20, energy:10 },
    crystalLab:{ metal:50, energy:20 },
    circuitFab:{ crystal:10, alloy:5, energy:30 }
};

const factoryProduction = {
    oreFactory:{ produce:{ore:1} },
    energyGen:{ produce:{energy:1} },
    smelter:{ consume:{ore:3}, produce:{metal:1} },
    alloySmelter:{ consume:{metal:2, energy:2}, produce:{alloy:1} },
    crystalLab:{ consume:{metal:5, energy:5}, produce:{crystal:1} },
    circuitFab:{ consume:{crystal:2, alloy:3, energy:10}, produce:{circuit:1} }
};

/* ===============================
        HELPERS
================================*/
function clampToStorage(resource, amount){
    return Math.min(amount, state.storageCap[resource] || amount);
}
function canAfford(cost){
    for(const k in cost) if((state.resources[k]||0)<cost[k]) return false;
    return true;
}
function payCost(cost){ for(const k in cost) state.resources[k]-=cost[k]; }
function addResource(key, amt){ if(state.resources[key]!==undefined) state.resources[key]=clampToStorage(key,state.resources[key]+amt); }

/* ===============================
        UI RENDER
================================*/
function renderResources(){
    const el=document.getElementById('resourcesList'); el.innerHTML='';
    for(const r in state.resources){
        if(state.resources[r]>0 || r==='ore' || r==='energy'){
            const div=document.createElement('div');
            div.textContent=`${r}: ${Math.floor(state.resources[r])} / ${state.storageCap[r]}`;
            el.appendChild(div);
        }
    }
}

function renderFactories(){
    const grid=document.getElementById('buildGrid'); grid.innerHTML='';
    const basicFactories=['oreFactory','energyGen','smelter'];
    for(const f of basicFactories){
        const cost=buildCosts[f];
        if(canAfford(cost)){
            const btn=document.createElement('button');
            btn.textContent=`Build ${f} (${Object.entries(cost).map(([k,v])=>v+' '+k).join('/')})`;
            btn.onclick=()=>{ buildFactory(f); };
            grid.appendChild(btn);
        }
    }
}

function renderAdvancedFactories(){
    const grid=document.getElementById('advancedGrid'); grid.innerHTML='';
    const advanced=['alloySmelter','crystalLab','circuitFab'];
    for(const f of advanced){
        const cost=buildCosts[f];
        if(canAfford(cost)){
            const btn=document.createElement('button');
            btn.textContent=`Build ${f} (${Object.entries(cost).map(([k,v])=>v+' '+k).join('/')})`;
            btn.onclick=()=>{ buildFactory(f); };
            grid.appendChild(btn);
        }
    }
}

function renderStorageUpgrade(){
    const area=document.getElementById('storageUpgradeArea'); area.innerHTML='';
    const lvl=state.upgrades.storageLevel;
    const cost={ ore:200*(lvl+1), metal:100*(lvl+1), energy:50*(lvl+1) };
    if(canAfford(cost)){
        const btn=document.createElement('button');
        btn.textContent=`Upgrade Storage (Level ${lvl+1}) - Cost: ${Object.entries(cost).map(([k,v])=>v+' '+k).join('/')}`;
        btn.onclick=()=>upgradeStorage();
        area.appendChild(btn);
    } else {
        area.textContent='Storage upgrade not affordable.';
    }
}

/* ===============================
        ACTIONS
================================*/
function startPlanet(name){
    state=JSON.parse(JSON.stringify(initialState));
    state.planet=name;
    const bonus=planets[name].bonus||{};
    for(const k in bonus) state.resources[k]=bonus[k];
    document.getElementById('planetSelector').style.display='none';
    document.getElementById('mainHUD').style.display='block';
    renderAll();
    save();
}

function manualMine(){ addResource('ore',1); renderAll(); save(); }
function manualEnergy(){ addResource('energy',1); renderAll(); save(); }

function buildFactory(key){
    const cost=buildCosts[key];
    if(!canAfford(cost)){ alert("Cannot afford."); return; }
    payCost(cost);
    state.factories[key]++;
    renderAll();
    save();
}

function upgradeStorage(){
    const lvl=state.upgrades.storageLevel;
    const cost={ ore:200*(lvl+1), metal:100*(lvl+1), energy:50*(lvl+1) };
    if(!canAfford(cost)){ alert("Cannot afford."); return; }
    payCost(cost);
    state.upgrades.storageLevel++;
    for(const r in state.storageCap) state.storageCap[r]=Math.floor(state.storageCap[r]*1.5);
    renderAll();
    save();
}

/* ===============================
        RESET
================================*/
function openResetMenu(){ document.getElementById('resetPopup').style.display='flex'; document.getElementById('resetOverlay').style.display='flex'; }
function closeResetMenu(){ document.getElementById('resetPopup').style.display='none'; document.getElementById('resetOverlay').style.display='none'; }
function resetGame(){ closeResetMenu(); state=JSON.parse(JSON.stringify(initialState)); save(); location.reload(); }

/* ===============================
        PRODUCTION LOOP
================================*/
function runProduction(dt){
    for(const key in factoryProduction){
        const cfg=factoryProduction[key];
        const count=state.factories[key];
        if(count<=0) continue;
        let canRun=true;
        if(cfg.consume) for(const r in cfg.consume) if((state.resources[r]||0)<cfg.consume[r]*dt) canRun=false;
        if(!canRun) continue;
        if(cfg.consume) for(const r in cfg.consume) state.resources[r]-=cfg.consume[r]*dt;
        if(cfg.produce) for(const r in cfg.produce) for(const r2 in cfg.produce) addResource(r2, cfg.produce[r2]*dt*count);
    }
}

let lastTime=Date.now();
function gameLoop(){
    const now=Date.now();
    let dt=(now-lastTime)/1000; lastTime=now;
    if(dt>0.25) dt=0.25;
    runProduction(dt);
    renderAll();
    requestAnimationFrame(gameLoop);
}

/* ===============================
        SAVE / LOAD
================================*/
function save(){ state.lastSaved=Date.now(); localStorage.setItem('spaceFactorySave',JSON.stringify(state)); }
function load(){ try{ const raw=localStorage.getItem('spaceFactorySave'); return raw?JSON.parse(raw):null; } catch{return null;} }

/* ===============================
        RENDER ALL
================================*/
function renderAll(){ 
    renderResources(); 
    renderFactories(); 
    renderAdvancedFactories(); 
    renderStorageUpgrade(); 
}

/* ===============================
        INIT
================================*/
if(state.planet){ document.getElementById('planetSelector').style.display='none'; document.getElementById('mainHUD').style.display='block'; }
renderAll(); 
gameLoop();
</script>
</body>
</html>

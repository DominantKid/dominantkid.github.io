<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Galaxy Industry</title>

<style>
:root {
    --bg: #071028;
    --panel: #0f1b3a;
    --accent: #6fb3ff;
    --muted: #9fb5d9;
    --glass: rgba(255,255,255,0.04);
}

/* -----------------------
   Global Styles
------------------------ */
html, body {
    height: 100%;
    margin: 0;
    background: linear-gradient(180deg, var(--bg), #031026);
    font-family: Inter, system-ui, monospace;
    color: #eaf4ff;
}

h1, h2, h3 {
    margin: 0;
}

/* -----------------------
   Galaxy Header
------------------------ */
.galaxy-header {
    padding: 28px 0 10px 0;
    text-align: center;
}

.galaxy-title {
    font-size: clamp(28px, 4vw, 48px);
    font-weight: 800;
    background: linear-gradient(90deg, #6fb3ff, #9f70ff, #ff70d7, #6fb3ff);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: galaxyFlow 8s ease infinite;
    text-shadow: 0 0 18px rgba(125,150,255,0.35), 0 0 35px rgba(150,90,255,0.25);
}

.galaxy-subtitle {
    margin-top: 6px;
    font-size: 15px;
    color: #bcd7ff;
    letter-spacing: 0.4px;
}

@keyframes galaxyFlow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* -----------------------
   Layout Panels
------------------------ */
#tabs {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-top: 10px;
}

.tab-btn {
    background: linear-gradient(180deg, var(--accent), #4e8fe3);
    border: none;
    color: #02112a;
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
}
.tab-btn.active {
    box-shadow: 0 0 15px rgba(111,179,255,0.6);
}

.tab-content {
    display: none;
    padding: 12px;
    margin: 12px auto;
    max-width: 1200px;
}

.tab-content.active {
    display: block;
}

.panel {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.04);
    border-radius: 12px;
    padding: 12px;
    box-shadow: 0 6px 20px rgba(3,6,20,0.6);
    margin-bottom: 16px;
}

button {
    background: linear-gradient(180deg, var(--accent), #4e8fe3);
    border: none;
    color: #02112a;
    padding: 8px 10px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
}
button:hover { filter: brightness(1.1); }
button:disabled { opacity: 0.45; cursor: not-allowed; }

/* Resource list */
.resource {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    border-bottom: 1px dashed rgba(255,255,255,0.03);
}

/* -----------------------
   Save Indicator
------------------------ */
.save-indicator {
    font-size: 12px;
    color: var(--muted);
}

/* -----------------------
   Overlays
------------------------ */
#resetOverlay {
    display:none;
    position: fixed; 
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.6);
    z-index: 999;
}
#resetPopup {
    display:none;
    position: fixed;
    top:50%; left:50%;
    transform: translate(-50%,-50%);
    background:#222;
    padding:20px;
    border-radius:8px;
    box-shadow:0 0 10px #ff4d4d;
    color:white;
    z-index:1000;
    text-align:center;
    min-width:250px;
}
</style>
</head>
<body>

<!-- HEADER -->
<header class="galaxy-header">
    <h1 class="galaxy-title">ðŸŒŒ Space Company Clone</h1>
    <div class="galaxy-subtitle">Build your interstellar empire, manage resources, and explore space!</div>
</header>

<!-- TABS -->
<div id="tabs">
    <button class="tab-btn active" data-tab="overview">Overview</button>
    <button class="tab-btn" data-tab="factories">Factories</button>
    <button class="tab-btn" data-tab="research">Research</button>
</div>

<!-- TAB CONTENTS -->
<div id="overview" class="tab-content active">
    <div class="panel">
        <h3>Resources</h3>
        <div id="resourcesList"></div>
    </div>
    <div class="panel">
        <h3>Actions</h3>
        <button onclick="collect('ore')">Collect Ore</button>
        <button onclick="collect('energy')">Generate Energy</button>
    </div>
</div>

<div id="factories" class="tab-content">
    <div class="panel">
        <h3>Factory List</h3>
        <div id="factoryGrid"></div>
    </div>
</div>

<div id="research" class="tab-content">
    <div class="panel">
        <h3>Research Lab</h3>
        <div id="researchList"></div>
    </div>
</div>

<!-- Reset Confirmation -->
<div id="resetOverlay"></div>
<div id="resetPopup">
    <p>Are you sure you want to reset the game?</p>
    <button onclick="resetGame()">Yes</button>
    <button onclick="closeResetMenu()">No</button>
</div>

<div style="text-align:center; margin-top:10px;">
    <span class="save-indicator" id="saveStatus">Not saved</span>
</div>

<script>
// ============================
// GAME STATE
// ============================
const initialState = {
    resources: { ore:0, metal:0, energy:0, crystal:0, alloy:0 },
    storage: { ore:1000, metal:500, energy:500, crystal:200, alloy:200 },
    factories: { mine:0, generator:0, smelter:0, crystalLab:0, alloyForge:0 },
    research: { autoMine:false, autoEnergy:false },
    lastSaved: null,
};

let state = load() || JSON.parse(JSON.stringify(initialState));

// ============================
// TAB FUNCTIONALITY
// ============================
document.querySelectorAll('.tab-btn').forEach(btn=>{
    btn.addEventListener('click',()=>{
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const tab = btn.dataset.tab;
        document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
        document.getElementById(tab).classList.add('active');
    });
});

// ============================
// RESOURCE LOGIC
// ============================
function collect(resource){
    let amount = 1;
    if(resource==='ore') state.resources.ore += amount;
    if(resource==='energy') state.resources.energy += amount;
    renderResources();
    save();
}

function addResource(resource, amount){
    if(state.resources[resource]===undefined) return;
    state.resources[resource] = Math.min(state.resources[resource]+amount, state.storage[resource]);
}

// ============================
// RENDER FUNCTIONS
// ============================
function renderResources(){
    const el = document.getElementById('resourcesList');
    el.innerHTML='';
    for(const r in state.resources){
        if(state.resources[r] > 0 || state.factories[r] > 0){
            el.innerHTML += `<div class="resource"><span>${r}</span><span>${state.resources[r]}</span></div>`;
        }
    }
}

function renderFactories(){
    const el = document.getElementById('factoryGrid');
    el.innerHTML='';
    const factories = [
        { key:'mine', name:'Ore Mine', cost:{ore:10} },
        { key:'generator', name:'Energy Generator', cost:{ore:5} },
        { key:'smelter', name:'Smelter', cost:{ore:20, energy:5} },
        { key:'crystalLab', name:'Crystal Lab', cost:{energy:15} },
        { key:'alloyForge', name:'Alloy Forge', cost:{metal:20, energy:10} }
    ];
    factories.forEach(f=>{
        const affordable = canAfford(f.cost);
        el.innerHTML += `
        <div style="margin-bottom:6px;">
            <b>${f.name}</b> - x${state.factories[f.key]} <br>
            <button onclick="buildFactory('${f.key}')" ${affordable?'':'disabled'}>Build (${renderCost(f.cost)})</button>
        </div>`;
    });
}

function renderResearch(){
    const el = document.getElementById('researchList');
    el.innerHTML='';
    const items = [
        { key:'autoMine', name:'Automatic Mining', cost:{ore:50} },
        { key:'autoEnergy', name:'Automatic Energy', cost:{energy:50} }
    ];
    items.forEach(i=>{
        const affordable = canAfford(i.cost) && !state.research[i.key];
        el.innerHTML += `
        <div style="margin-bottom:6px;">
            <b>${i.name}</b> - ${state.research[i.key] ? 'Researched' : 'Not researched'} <br>
            <button onclick="doResearch('${i.key}')" ${affordable?'':'disabled'}>Research (${renderCost(i.cost)})</button>
        </div>`;
    });
}

// ============================
// HELPER FUNCTIONS
// ============================
function canAfford(cost){
    for(const r in cost){
        if(state.resources[r]===undefined || state.resources[r]<cost[r]) return false;
    }
    return true;
}

function payCost(cost){
    for(const r in cost) state.resources[r] -= cost[r];
}

function renderCost(cost){
    return Object.entries(cost).map(([r,v])=>`${v} ${r}`).join(' / ');
}

// ============================
// FACTORY ACTIONS
// ============================
function buildFactory(key){
    const factoryCosts = {
        mine:{ore:10},
        generator:{ore:5},
        smelter:{ore:20, energy:5},
        crystalLab:{energy:15},
        alloyForge:{metal:20, energy:10}
    };
    const cost = factoryCosts[key];
    if(!canAfford(cost)) return;
    payCost(cost);
    state.factories[key]++;
    renderResources();
    renderFactories();
    save();
}

// ============================
// RESEARCH ACTIONS
// ============================
function doResearch(key){
    const researchCosts = {
        autoMine:{ore:50},
        autoEnergy:{energy:50}
    };
    const cost = researchCosts[key];
    if(!canAfford(cost) || state.research[key]) return;
    payCost(cost);
    state.research[key]=true;
    renderResearch();
    save();
}

// ============================
// AUTO PRODUCTION LOOP
// ============================
function autoProduction(dt){
    for(const f in state.factories){
        const count = state.factories[f];
        if(count<=0) continue;
        switch(f){
            case 'mine': addResource('ore', dt*count); break;
            case 'generator': addResource('energy', dt*count); break;
            case 'smelter':
                if(state.resources.ore>=dt*count && state.resources.energy>=dt*count){
                    state.resources.ore-=dt*count;
                    state.resources.energy-=dt*count;
                    addResource('metal', dt*count);
                }
                break;
            case 'crystalLab':
                if(state.resources.energy>=dt*count) addResource('crystal', dt*count);
                break;
            case 'alloyForge':
                if(state.resources.metal>=dt*count && state.resources.energy>=dt*count){
                    state.resources.metal-=dt*count;
                    state.resources.energy-=dt*count;
                    addResource('alloy', dt*count);
                }
                break;
        }
    }

    if(state.research.autoMine) addResource('ore', dt*state.factories.mine);
    if(state.research.autoEnergy) addResource('energy', dt*state.factories.generator);
}

// ============================
// SAVE / LOAD
// ============================
function save(){
    state.lastSaved = Date.now();
    localStorage.setItem('spaceCompanySave', JSON.stringify(state));
    document.getElementById('saveStatus').innerText = `Saved at ${new Date(state.lastSaved).toLocaleTimeString()}`;
}

function load(){
    try{
        const raw = localStorage.getItem('spaceCompanySave');
        return raw ? JSON.parse(raw) : null;
    } catch { return null; }
}

// ============================
// RESET MENU
// ============================
function openResetMenu(){
    document.getElementById('resetPopup').style.display='block';
    document.getElementById('resetOverlay').style.display='block';
}

function closeResetMenu(){
    document.getElementById('resetPopup').style.display='none';
    document.getElementById('resetOverlay').style.display='none';
}

function resetGame(){
    state = JSON.parse(JSON.stringify(initialState));
    closeResetMenu();
    renderAll();
    save();
}

// ============================
// MAIN LOOP
// ============================
let lastTime = Date.now();
function gameLoop(){
    const now = Date.now();
    let dt = (now-lastTime)/1000;
    lastTime = now;
    if(dt>0.25) dt=0.25;
    autoProduction(dt);
    renderAll();
    requestAnimationFrame(gameLoop);
}

// ============================
// RENDER ALL
// ============================
function renderAll(){
    renderResources();
    renderFactories();
    renderResearch();
}

renderAll();
requestAnimationFrame(gameLoop);
// ============================
// STORAGE UPGRADES
// ============================
const storageUpgradeBase = {
    ore: 1000,
    metal: 500,
    energy: 500,
    crystal: 200,
    alloy: 200
};

const storageUpgradeMultiplier = 1.5;

function upgradeStorage(resource){
    const cost = Math.floor(storageUpgradeBase[resource] / 2);
    if(state.resources[resource] < cost) return;
    state.resources[resource] -= cost;
    state.storage[resource] = Math.floor(state.storage[resource]*storageUpgradeMultiplier);
    storageUpgradeBase[resource] = state.storage[resource];
    renderStorageUpgrades();
    renderResources();
    save();
}

function renderStorageUpgrades(){
    let el = document.getElementById('storageUpgrades');
    if(!el){
        const overview = document.getElementById('overview');
        const panel = document.createElement('div');
        panel.className='panel';
        panel.innerHTML='<h3>Storage Upgrades</h3><div id="storageUpgrades"></div>';
        overview.appendChild(panel);
        el = document.getElementById('storageUpgrades');
    }
    el.innerHTML='';
    for(const r in state.resources){
        const cost = Math.floor(storageUpgradeBase[r]/2);
        const canBuy = state.resources[r]>=cost;
        el.innerHTML += `
            <div style="margin-bottom:6px;">
                <b>${r} Storage:</b> ${state.storage[r]} <br>
                <button onclick="upgradeStorage('${r}')" ${canBuy?'':'disabled'}>
                    Upgrade (${cost} ${r})
                </button>
            </div>
        `;
    }
}

// ============================
// MISSIONS / EVENTS
// ============================
let missions = [
    { name:'Asteroid Survey', req:{ore:50}, reward:{crystal:20}, done:false },
    { name:'Energy Relay Setup', req:{energy:100}, reward:{metal:50}, done:false }
];

function renderMissions(){
    let el = document.getElementById('missionPanel');
    if(!el){
        const overview = document.getElementById('overview');
        const panel = document.createElement('div');
        panel.className='panel';
        panel.innerHTML='<h3>Missions</h3><div id="missionPanel"></div>';
        overview.appendChild(panel);
        el = document.getElementById('missionPanel');
    }
    el.innerHTML='';
    missions.forEach((m,i)=>{
        if(m.done) return;
        const canStart = canAfford(m.req);
        el.innerHTML += `
            <div style="margin-bottom:6px;">
                <b>${m.name}</b> <br>
                <button onclick="startMission(${i})" ${canStart?'':'disabled'}>
                    Start (${renderCost(m.req)})
                </button>
            </div>
        `;
    });
}

function startMission(index){
    const mission = missions[index];
    if(!canAfford(mission.req)) return;
    payCost(mission.req);
    // instant reward for simplicity, could add timers
    for(const r in mission.reward) addResource(r, mission.reward[r]);
    mission.done = true;
    renderAll();
    renderMissions();
    save();
}

// ============================
// ACHIEVEMENTS
// ============================
const achievements = [
    { id:'firstOre', name:'First Ore Collected', check:()=>state.resources.ore>=1, done:false },
    { id:'metalMaster', name:'Metal Collector', check:()=>state.resources.metal>=100, done:false }
];

function renderAchievements(){
    let el = document.getElementById('achievementPanel');
    if(!el){
        const overview = document.getElementById('overview');
        const panel = document.createElement('div');
        panel.className='panel';
        panel.innerHTML='<h3>Achievements</h3><div id="achievementPanel"></div>';
        overview.appendChild(panel);
        el = document.getElementById('achievementPanel');
    }
    el.innerHTML='';
    achievements.forEach(a=>{
        if(a.done){
            el.innerHTML += `<div style="margin-bottom:6px; color:#6f6;">${a.name} âœ…</div>`;
        } else if(a.check()){
            a.done = true;
            el.innerHTML += `<div style="margin-bottom:6px; color:#6f6;">${a.name} âœ…</div>`;
        } else {
            el.innerHTML += `<div style="margin-bottom:6px; color:#999;">${a.name}</div>`;
        }
    });
}

// ============================
// AUTOMATION / AUTO-UPGRADES
// ============================
function autoFactories(){
    for(const f in state.factories){
        if(state.factories[f]>0){
            addResource('ore', state.factories[f]*0.1);
            addResource('energy', state.factories[f]*0.1);
        }
    }
}

// ============================
// GAME LOOP EXTENSIONS
// ============================
function extendedLoop(){
    const now = Date.now();
    let dt = (now-lastTime)/1000;
    lastTime = now;
    if(dt>0.25) dt=0.25;

    autoProduction(dt);
    autoFactories();
    renderAll();
    renderMissions();
    renderAchievements();
    renderStorageUpgrades();

    requestAnimationFrame(extendedLoop);
}

// ============================
// INITIAL RENDER CALLS
// ============================
renderMissions();
renderAchievements();
renderStorageUpgrades();
requestAnimationFrame(extendedLoop);

// ============================
// HOTKEYS (Optional Fun Feature)
// ============================
document.addEventListener('keydown', e=>{
    if(e.key==='r') openResetMenu();
    if(e.key==='o') collect('ore');
    if(e.key==='e') collect('energy');
});

// ============================
// FINAL SAVE INTERVAL
// ============================
setInterval(save, 5000);

// ============================
// UI & TABS
// ============================

// Add main tabs
const tabs = ['Overview','Missions','Research','Achievements','Storage'];
let currentTab = 'Overview';

function renderTabs(){
    let tabBar = document.getElementById('tabBar');
    if(!tabBar){
        tabBar = document.createElement('div');
        tabBar.id='tabBar';
        tabBar.style.display='flex';
        tabBar.style.marginBottom='10px';
        tabBar.style.justifyContent='space-around';
        document.body.insertBefore(tabBar, document.getElementById('overview'));
    }
    tabBar.innerHTML='';
    tabs.forEach(tab=>{
        const button = document.createElement('button');
        button.innerText = tab;
        button.onclick=()=>switchTab(tab);
        button.style.flex='1';
        button.style.margin='0 2px';
        button.style.padding='6px';
        button.style.border='none';
        button.style.borderRadius='5px';
        button.style.background = currentTab===tab ? 'linear-gradient(to right, #4a90e2, #50e3c2)' : 'linear-gradient(to right, #888, #aaa)';
        button.style.color='white';
        button.style.cursor='pointer';
        button.onmouseover = ()=>button.style.opacity='0.85';
        button.onmouseout = ()=>button.style.opacity='1';
        tabBar.appendChild(button);
    });
}

function switchTab(tab){
    currentTab = tab;
    tabs.forEach(t=>{
        const panel = document.getElementById(t.toLowerCase()+'Panel') || document.getElementById(t.toLowerCase()+'Upgrades');
        if(panel) panel.style.display = (t===tab)?'block':'none';
    });
    renderTabs();
}

// ============================
// GRADIENT BUTTON STYLING
// ============================
function styleButtons(){
    const buttons = document.querySelectorAll('button');
    buttons.forEach(btn=>{
        if(!btn.style.background.includes('linear-gradient')){
            btn.style.background = 'linear-gradient(to right, #6a11cb, #2575fc)';
            btn.style.color = 'white';
            btn.style.border='none';
            btn.style.borderRadius='5px';
            btn.style.padding='4px 8px';
            btn.style.margin='2px 0';
            btn.style.cursor='pointer';
            btn.onmouseover=()=>btn.style.opacity='0.85';
            btn.onmouseout=()=>btn.style.opacity='1';
        }
    });
}

// ============================
// RESEARCH TAB
// ============================
if(!state.research) state.research={automation:false, efficiency:false, storageBoost:false};
const researchList=[
    {id:'automation', name:'Auto Production', cost:{crystal:50, metal:50}},
    {id:'efficiency', name:'Resource Efficiency', cost:{metal:100, alloy:50}},
    {id:'storageBoost', name:'Storage Boost', cost:{alloy:100, crystal:50}}
];

function renderResearch(){
    let el = document.getElementById('researchPanel');
    if(!el){
        const overview = document.getElementById('overview');
        const panel = document.createElement('div');
        panel.id='researchPanel';
        panel.className='panel';
        panel.innerHTML='<h3>Research</h3>';
        overview.appendChild(panel);
        el = panel;
    }
    el.style.display=(currentTab==='Research')?'block':'none';
    el.innerHTML='<h3>Research</h3>';
    researchList.forEach(r=>{
        const done = state.research[r.id];
        const canAffordRes = canAfford(r.cost);
        el.innerHTML += `
            <div style="margin-bottom:6px;">
                <b>${r.name}</b> ${done?'âœ…':'(Cost: '+renderCost(r.cost)+')'}<br>
                <button onclick="buyResearch('${r.id}')" ${done||!canAffordRes?'disabled':''}>
                    ${done?'Completed':'Research'}
                </button>
            </div>
        `;
    });
    styleButtons();
}

function buyResearch(id){
    const research = researchList.find(r=>r.id===id);
    if(!research || state.research[id]) return;
    if(!canAfford(research.cost)) return;
    payCost(research.cost);
    state.research[id]=true;

    // Apply effects
    if(id==='automation'){
        state.autoProduction=true;
    }
    if(id==='efficiency'){
        for(const r in state.resources) state.resources[r]*=1.1;
    }
    if(id==='storageBoost'){
        for(const r in state.storage) state.storage[r]=Math.floor(state.storage[r]*1.2);
    }
    renderAll();
    renderResearch();
    save();
}

// ============================
// OVERALL PANEL STYLING
// ============================
document.querySelectorAll('.panel').forEach(panel=>{
    panel.style.background='linear-gradient(to bottom, #222, #444)';
    panel.style.color='white';
    panel.style.borderRadius='10px';
    panel.style.padding='10px';
    panel.style.margin='8px';
});

// ============================
// INITIAL CALLS
// ============================
renderTabs();
switchTab('Overview');
renderResearch();
styleButtons();
// ============================
// FIX FACTORY PRODUCTION LOOP
// ============================
if(state.autoProduction === undefined) state.autoProduction = false;

function runFactoryProduction(key, dt){
    const cfg = factoryProduction[key];
    const count = state.factories[key] || 0;
    if(count <= 0) return;

    for(let i=0;i<count;i++){
        let canRun = true;
        if(cfg.consume){
            for(const r in cfg.consume){
                const need = cfg.consume[r] * dt;
                if((state.resources[r]||0) < need){
                    canRun = false;
                    break;
                }
            }
        }
        if(!canRun) continue;

        // Apply consumption
        if(cfg.consume){
            for(const r in cfg.consume){
                const amt = cfg.consume[r] * dt;
                state.resources[r] -= amt;
            }
        }

        // Apply production
        if(cfg.produce){
            for(const r in cfg.produce){
                const amt = cfg.produce[r] * dt * (state.research.efficiency?1.2:1);
                addResource(r, amt);
            }
        }
    }
}

let lastTime = Date.now();
function gameLoop(){
    const now = Date.now();
    let dt = (now - lastTime)/1000;
    lastTime = now;
    if(dt>0.25) dt = 0.25;

    if(state.autoProduction || state.research.automation){
        for(const key in factoryProduction){
            runFactoryProduction(key, dt);
        }

        // Europa passive bonus
        if(state.planet === 'Europa'){
            addResource('crystal', 0.02 * dt);
        }
    }

    // Update UI every 0.4s
    state.tickAccumulator = (state.tickAccumulator || 0) + dt;
    if(state.tickAccumulator >= 0.4){
        renderAll();
        renderResearch();
        state.tickAccumulator = 0;
    }

    // Auto-save every 10 seconds
    if(!state.lastSaved || Date.now()-state.lastSaved > 10000){
        save();
    }

    requestAnimationFrame(gameLoop);
}

// Start the loop
requestAnimationFrame(gameLoop);
// ============================
// RENDER BUILD GRID WITH AFFORDABILITY CHECK
// ============================
function renderBuildGrid(){
    const grid = document.getElementById("buildGrid");
    grid.innerHTML = "";

    const items = [
        {key:'oreFactory', name:'Ore Mine', desc:'Extracts raw ore', cost:buildCosts.oreFactory},
        {key:'energyGen', name:'Solar Plant', desc:'Generates energy', cost:buildCosts.energyGen},
        {key:'smelter', name:'Smelter', desc:'Ore â†’ Metal', cost:buildCosts.smelter},
        {key:'crystalExtractor', name:'Crystal Extractor', desc:'Extracts crystals', cost:buildCosts.crystalExtractor},
        {key:'circuitFoundry', name:'Circuit Foundry', desc:'Metal+Crystal â†’ Circuits', cost:buildCosts.circuitFoundry},
        {key:'alloyForge', name:'Alloy Forge', desc:'Metal â†’ Alloy', cost:buildCosts.alloyForge},
        {key:'fuelProcessor', name:'Fuel Processor', desc:'Ore+Energy â†’ Fuel Cells', cost:buildCosts.fuelProcessor}
    ];

    items.forEach(it => {
        const div = document.createElement("div");
        div.style.padding = "6px 0";

        const canBuy = canAfford(it.cost);

        div.innerHTML = `
            <div style="font-weight:700">${it.name} <span class="muted">x${state.factories[it.key]}</span></div>
            <div class="muted">${it.desc}</div>
            <div class="muted" style="font-size:13px">${renderCost(it.cost)}</div>
            <button ${canBuy ? '' : 'disabled'} onclick="buildFactory('${it.key}')">
                Build
            </button>
        `;
        grid.appendChild(div);
    });
}

// Helper: check if cost is affordable
function canAfford(cost){
    for(const key in cost){
        if((state.resources[key]||0) < cost[key]) return false;
    }
    return true;
}

</script>
</body>
</html>

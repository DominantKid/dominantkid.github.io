<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trust No One – Multiplayer Proto</title>
<style>
  body { font-family: Arial, sans-serif; background: #111; color: #eee; padding: 20px; }
  input, button { padding: 6px; margin: 6px; }
  .company { background: #222; padding: 10px; margin: 5px 0; }
</style>
</head>
<body>
<h1>Trust No One – Multiplayer</h1>

<!-- LOGIN / REGISTER SCREEN -->
<div id="loginDiv">
  <h2>Login or Register</h2>
  <input type="text" id="usernameInput" placeholder="Your username">
  <br>
  <input type="password" id="passwordInput" placeholder="Password">
  <br>
  <button onclick="loginOrRegister()">Login / Register</button>
</div>

<!-- HOME SCREEN -->
<div id="homeDiv" style="display:none;">
  <h2>Home</h2>
  <p>Logged in as <b><span id="userName"></span></b></p>
  <button onclick="enterGame()">Enter Company</button>
  <button onclick="logout()">Log Out</button>
</div>

<!-- GAME SCREEN -->
<div id="gameDiv" style="display:none;">
  <h2>Your Company</h2>
  <input type="text" id="companyName" placeholder="Company name">
  <br>
  <input type="password" id="companyPassword" placeholder="Set a company password">
  <br>
  <button onclick="createCompany()">Create Company</button>
  <h3>Your Money: $<span id="yourMoney">0</span></h3>
  <h3>All Companies</h3>
  <div id="companyList"></div>
  <br>
  <button onclick="goHome()">Back</button>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let currentUser = null;
let currentCompany = null;

window.onload = () => {
  const savedUser = localStorage.getItem('tno_user');
  const savedPass = localStorage.getItem('tno_pass');
  if (savedUser && savedPass) {
    currentUser = savedUser;
    showHome();
  }
};

function loginOrRegister() {
  const name = document.getElementById('usernameInput').value.trim();
  const password = document.getElementById('passwordInput').value;
  if (!name || !password) { alert('Enter both username and password'); return; }

  const storedPass = localStorage.getItem('tno_pass_' + name);
  if (storedPass && storedPass !== password) {
    alert('Incorrect password');
    return;
  } else if (!storedPass) {
    localStorage.setItem('tno_pass_' + name, password);
  }

  currentUser = name;
  localStorage.setItem('tno_user', name);
  localStorage.setItem('tno_pass', password);
  showHome();
}

function logout() {
  localStorage.removeItem('tno_user');
  localStorage.removeItem('tno_pass');
  currentUser = null;
  currentCompany = null;
  hideAll();
  document.getElementById('loginDiv').style.display = 'block';
}

function showHome() {
  hideAll();
  document.getElementById('homeDiv').style.display = 'block';
  document.getElementById('userName').textContent = currentUser;
}

function enterGame() {
  hideAll();
  document.getElementById('gameDiv').style.display = 'block';
  loadCompanies();
  loadCurrentCompany();
}

function goHome() { showHome(); }
function hideAll() {
  document.getElementById('loginDiv').style.display = 'none';
  document.getElementById('homeDiv').style.display = 'none';
  document.getElementById('gameDiv').style.display = 'none';
}

// Firebase based company functions
function createCompany() {
  const name = document.getElementById('companyName').value.trim();
  const password = document.getElementById('companyPassword').value;
  if (!name || !password) { alert('Enter company name and password'); return; }

  currentCompany = { owner: currentUser, name: name, money: 100, guards: 0, password: password };
  db.ref('companies/' + currentUser).set(currentCompany);
  updateMoney();
}

function loadCompanies() {
  const list = document.getElementById('companyList');
  list.innerHTML = '';
  db.ref('companies').on('value', snapshot => {
    const companies = snapshot.val() || {};
    list.innerHTML = '';
    Object.values(companies).forEach(c => {
      const div = document.createElement('div');
      div.className = 'company';
      div.textContent = `${c.name} — owned by ${c.owner} ($${c.money})`;
      list.appendChild(div);
    });
  });
}

function loadCurrentCompany() {
  if (!currentUser) return;
  db.ref('companies/' + currentUser).on('value', snapshot => {
    currentCompany = snapshot.val();
    updateMoney();
  });
}

function updateMoney() {
  document.getElementById('yourMoney').textContent = currentCompany ? currentCompany.money : 0;
}
</script>
</body>
</html>
